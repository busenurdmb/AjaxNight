@{
    Layout = null;
}

<link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ürün Ekleme Paneli</title>
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> 
    <link rel="stylesheet" href="~/css/main.css"> 
    <style>
     
    </style>
</head>
<body>
    <div class="glowing-title">
        <span>Ü</span><span>r</span>ü<span>n</span><span></span><span></span>
       @*  E<span>k</span><span>l</span><span>e</span><span>m</span><span>e</span><span></span> *@
        <span>P</span><span>a</span>n<span>e</span><span>l</span><span>i</span>
    </div>

    <div class="form-container">
      

        <div class="btn-group">
            <button id="btnlist" class="btn-custom">Ürün Listesi</button>
            <button id="btncreate" class="btn-custom">Ürün Ekle</button>
        @*     <button id="btndelete" class="btn-custom">Ürün Sil</button>
            <button id="btnupdate" class="btn-custom">Ürün Güncelle</button> *@
           @*  <button id="btnget" class="btn-custom">Ürün Getir</button> *@
        </div>

        <hr />

       @*  <div class="alert alert-dark">Ürün Listesi</div> *@
        <div id="productlist"></div>

        <div id="popup-create" class="popup">
            <div class="popup-content">
                <span id="popup-create-close" class="popup-close">&times;</span>
                <h3 class="alert alert-success">Yeni Ürün Ekle</h3>
                <div>
                    <input type="text" placeholder="Ürün Adını Giriniz" id="productname" class="form-control" />
                    <br />
                    <input type="text" placeholder="Ürün Stok Sayısını Giriniz" id="productstock" class="form-control" />
                    <br />
                    <input type="text" placeholder="Ürün Fiyatını Giriniz" id="productprice" class="form-control" />
                    <br />
                    <button id="btn-create" class="btn-custom">Ekle</button>
                </div>
            </div>
        </div>

        <div id="popup-update" class="popup">
            <div class="popup-content">
                <span id="popup-update-close" class="popup-close">&times;</span>
                <h3 class="alert alert-success">Ürün Güncelle</h3>
                <div>
                    <input type="hidden" id="productidedit" />
                    <input type="text" placeholder="Güncellenecek Ürün Adını Giriniz" id="productnameedit" class="form-control" />
                    <br />
                    <input type="text" placeholder="Güncellenecek Ürün Stok Sayısını Giriniz" id="productstockedit" class="form-control" />
                    <br />
                    <input type="text" placeholder="Güncellenecek Ürün Fiyatını Giriniz" id="productpriceedit" class="form-control" />
                    <br />
                    <br />
                    <button id="btn-update" class="btn-custom">Güncelle</button>
                </div>
            </div>
        </div>

    </div>
    <div class="chain-animation">
        <span style="animation-delay: 0s;">A</span><span style="animation-delay: 0.1s;">J</span><span style="animation-delay: 0.2s;">A</span><span style="animation-delay: 0.3s;">X</span>
    </div>
    <script>
        $("#btnlist").click(function () {
            $.ajax({
                contentType: "application/json",
                dataType: "json",
                type: "Get",
                url: "/Default/ProductList/",
                success: function (funk1) {
                    let products = jQuery.parseJSON(funk1);
                    console.log(products);

                    let tablehtml = "<table class='table table-bordered text-white'>"
                        + "<tr>"
                        + "<th>Ürün Id</th>"
                        + "<th>Ürün Adı</th>"
                        + "<th>Ürün Fiyat</th>"
                        + "<th>Ürün Stok</th>"
                        + "<th>Sil</th>"
                        + "<th>Güncelle</th>"
                        + "</tr>";
                    $.each(products, (index, value) => {
                        tablehtml += `<tr>`
                            + `<td>${value.ProductId}</td>`
                            + `<td>${value.ProductName}</td>`
                            + `<td>${value.Price}</td>`
                            + `<td>${value.Stock}</td>`
                            + `<td><button class="btn btn-danger btn-delete" data-id="${value.ProductId}">Sil</button></td>`
                            + `<td> <button class="btn btn-warning btn-update" data-id="${value.ProductId}" data-bs-toggle="modal" data-bs-target="#popup-update">Güncelle</button></td>`
                            + `</tr>`;
                    });
                    tablehtml += "</table>";
                    $("#productlist").html(tablehtml);
                }
            });
        });

        $("#btncreate").click(function () {
            $("#popup-create").fadeIn();
        });
        //Table üzerinden silme
        $("#productlist").on('click', '.btn-delete', function () {
            let productId = $(this).data('id');
            console.log(productId);
            Swal.fire({
                title: "Emin misiniz?",
                text: "Bu işlemi geri alamazsınız!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Evet, sil!"
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: "delete",
                        url: `/Default/DeleteProduct/${productId}`,
                        success: function (funk6) {
                            $("#btnlist").click();
                            Swal.fire({
                                title: "Silindi!",
                                text: "Ürün başarıyla silindi.",
                                icon: "success"
                            });
                        }
                    });
                }
            });
        });
        $("#btndelete").click(function () {
            let id = $("#productdeletedid").val();
            $.ajax({
                url: "/Default/DeleteProduct/" + id,
                type: "post",
                contentType: "application/json",
                dataType: "json",
                success: function (funk3) {
                    swal("Ürün Başarıyla Silindi");
                }
            });
        });

        $("#btnget").click(function () {
            let id = $("#productgetid").val();
            $.ajax({
                contentType: "application/json",
                dataType: "json",
                url: "/Default/GetProduct/" + id,
                success: function (funk4) {
                    let result = jQuery.parseJSON(funk4);
                    console.log(result);
                }
            });
        });

   

      
        //Table üzerinden güncelleme
        $("#productlist").on('click', '.btn-update', function () {
            // Güncellenecek ürünün ID'sini al
            let productId = $(this).data("id");
            console.log(productId);
            // AJAX ile ürün detaylarını getir
            $.ajax({
                url: "/Default/GetProduct/" + productId,
                type: "GET",
                dataType: "json",
                success: function (funk4) {
                    let response = JSON.parse(funk4);
                    console.log(response);
                    // Ürün bilgilerini popup içinde doldur
                    $("#productidedit").val(response.ProductId);
                    $("#productnameedit").val(response.ProductName);
                    $("#productstockedit").val(response.Stock);
                    $("#productpriceedit").val(response.Price);

                    // Popup'ı göster
                    $("#popup-update").fadeIn();
                },
                error: function () {
                    alert("Ürün bilgileri getirilirken hata oluştu.");
                }
            });
        });

        $(".popup-close").click(function () {
            $(this).closest(".popup").fadeOut();
        });

        $("#btn-create").click(function () {
            let productvalues = {
                ProductName: $("#productname").val(),
                Stock: $("#productstock").val(),
                Price: $("#productprice").val()
            };

            $.ajax({
                type: "post",
                url: "/Default/CreateProduct/",
                data: productvalues,
                success: function (funk2) {
                    let result = jQuery.parseJSON(funk2);
                    console.log("BAŞARILI");
                    Swal.fire({
                        title: "Eklendi!",
                        text: "Ürün başarıyla eklendi.",
                        icon: "success"
                    });
                    $("#popup-create").fadeOut();
                    $("#btnlist").click();
                }
            });
        });

        $("#btn-update").click(function () {
            let values = {
                ProductId: $("#productidedit").val(),
                ProductName: $("#productnameedit").val(),
                Price: $("#productpriceedit").val(),
                Stock: $("#productstockedit").val()
            };

            $.ajax({
                url: "/Default/UpdateProduct/",
                data: values,
                success: function (funk5) {
                    Swal.fire({
                        title: "Güncellendi!",
                        text: "Ürün başarıyla Güncellendi.",
                        icon: "success"
                    });
                    
                    $("#popup-update").fadeOut();

                    // Ürün listesini yeniden getir
                    $("#btnlist").click();
                }
            });
        });
    </script>
</body>
</html>
